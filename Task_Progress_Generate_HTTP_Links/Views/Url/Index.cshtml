@{
    Layout = "_Layout";
}
<h1>URL Short</h1>

<form method="post" asp-controller="Url" asp-action="Shorten">
    @Html.AntiForgeryToken()
    <input type="url" name="url" value="" placeholder="https://example.com/..." style="width:400px;" required />
    <button type="submit">Shorten</button>
</form>

@if (!ViewData.ModelState.IsValid)
{
    <div style="color:red">
        @foreach(var err in ViewData.ModelState.Values.SelectMany(v => v.Errors))
        {
            <div>@err.ErrorMessage</div>
        }
    </div>
}

@if (ViewBag.ShortUrl != null)
{
    <p>Shorten URL: <a href="@ViewBag.ShortUrl" target="_blank">@ViewBag.ShortUrl</a></p>
    <p>Statistics (secret): <a href="@ViewBag.SecretUrl" target="_blank">@ViewBag.SecretUrl</a></p>
}

@if (ViewBag.TopIds != null && ((IEnumerable<dynamic>)ViewBag.TopIds).Any())
{
    <h2>Top 10 IP address</h2>
    <table border="1" cellpadding="5">
        <thead>
            <tr>
                <th>IP Address</th>
                <th>URL</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in ViewBag.TopIds)
            {
                <tr>
                    <td>@item.IPAddress</td>
                    <td>@item.Url</td>
                    <td>@item.Date.ToString("yyyy-MM-dd HH:mm:ss")</td>
                </tr>
            }
        </tbody>
    </table>
}